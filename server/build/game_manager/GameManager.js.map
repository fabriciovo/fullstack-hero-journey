{"version":3,"file":"GameManager.js","names":["_jsonwebtoken","_interopRequireDefault","require","_ChatModel","levelData","_interopRequireWildcard","_MonsterController","_PlayerController","_ItemController","_NpcController","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","GameManager","exports","io","_classCallCheck2","monsterController","undefined","playerController","itemController","npcController","playerLocations","chestLocations","monsterLocations","npcLocations","_createClass2","key","value","setup","parseMapData","setupControllers","setupEventListeners","MonsterController","PlayerController","ItemController","NpcController","_this","layers","forEach","layer","name","objects","obj","push","x","y","properties","spawner","_this2","on","socket","err","console","log","concat","message","_ref","_asyncToGenerator2","_regenerator","mark","_callee","token","player","decoded","email","wrap","_callee$","_context","prev","next","jwt","verify","process","env","JWT_SECRET","user","ChatModel","create","emit","playerName","t0","stop","_x","_x2","_x3","apply","arguments","players","monsters","chests","items","npcs"],"sources":["../../src/game_manager/GameManager.js"],"sourcesContent":["import jwt from \"jsonwebtoken\";\n\nimport ChatModel from \"../models/ChatModel\";\n\nimport * as levelData from \"../../public/assets/level/new_level.json\";\n\nimport MonsterController from \"./controllers/MonsterController\";\nimport PlayerController from \"./controllers/PlayerController\";\nimport ItemController from \"./controllers/ItemController\";\nimport NpcController from \"./controllers/NpcController\";\n\nexport default class GameManager {\n  constructor(io) {\n    this.io = io;\n\n    this.monsterController = undefined;\n    this.playerController = undefined;\n    this.itemController = undefined;\n    this.npcController = undefined;\n    \n    this.levelData = levelData;\n\n    this.playerLocations = [[200,200]];\n    this.chestLocations = {};\n    this.monsterLocations = {};\n    this.npcLocations = [];\n  }\n\n  setup() {\n    this.parseMapData();\n    this.setupControllers();\n    this.setupEventListeners();\n  }\n\n  setupControllers(){\n    this.monsterController = new MonsterController(this.io,this.monsterLocations);\n    this.playerController = new PlayerController(this.io,this.playerLocations);\n    this.itemController = new ItemController(this.io);\n    this.npcController = new NpcController(this.io,this.npcLocations);\n  }\n\n  parseMapData() {\n    this.levelData = levelData;\n    this.levelData.layers.forEach((layer) => {\n      if (layer.name === \"player_locations\") {\n        layer.objects.forEach((obj) => {\n          this.playerLocations.push([obj.x, obj.y]);\n        });\n      } else if (layer.name === \"monster_locations\") {\n        layer.objects.forEach((obj) => {\n          if (this.monsterLocations[obj.properties.spawner]) {\n            this.monsterLocations[obj.properties.spawner].push([obj.x, obj.y]);\n          } else {\n            this.monsterLocations[obj.properties.spawner] = [[obj.x, obj.y]];\n          }\n        });\n      } else if (layer.name === \"chest_locations\") {\n        layer.objects.forEach((obj) => {\n          if (this.chestLocations[obj.properties.spawner]) {\n            this.chestLocations[obj.properties.spawner].push([obj.x, obj.y]);\n          } else {\n            this.chestLocations[obj.properties.spawner] = [[obj.x, obj.y]];\n          }\n        });\n      } else if (layer.name === \"npc_locations\") {\n        layer.objects.forEach((obj) => {\n          if (this.npcLocations[obj.properties.spawner]) {\n            this.npcLocations.push([obj.x, obj.y]);\n          } else {\n            this.npcLocations.push([obj.x, obj.y]);\n          }\n        });\n      }\n    });\n  }\n\n  setupEventListeners() {\n    this.io.on(\"connection\", (socket) => {\n      socket.on(\"connect_error\", (err) => {\n        console.log(`connect_error due to ${err.message}`);\n      });\n\n      this.monsterController.setupEventListeners(socket);\n      this.itemController.setupEventListeners(socket);\n      this.npcController.setupEventListeners(socket);\n      this.playerController.setupEventListeners(socket);\n\n      socket.on(\"sendMessage\", async (message, token, player) => {\n        try {\n          const decoded = jwt.verify(token, process.env.JWT_SECRET);\n          const { email } = decoded.user;\n          await ChatModel.create({ email, message });\n          this.io.emit(\"newMessage\", {\n            message,\n            name: player.playerName,\n          });\n        } catch (error) {\n          console.log(error);\n        }\n      });\n\n      socket.on(\"currents\", () => {\n        socket.emit(\"currentPlayers\", this.playerController.players);\n        socket.emit(\"currentMonsters\", this.monsterController.monsters);\n        socket.emit(\"currentChests\", this.itemController.chests);\n        socket.emit(\"currentItems\", this.itemController.items);\n        socket.emit(\"currentNpcs\", this.npcController.npcs);\n      });\n\n      // player connected to our game\n      console.log(\"player connected to our game\");\n    });\n  }\n}\n"],"mappings":"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","ignoreList":[]}