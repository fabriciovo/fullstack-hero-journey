{"version":3,"file":"MonsterController.js","names":["_MonsterModel","_interopRequireDefault","require","enemyData","_interopRequireWildcard","_uuid","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","MonsterController","exports","io","_classCallCheck2","monsters","monsterLocations","setupSpawn","init","_createClass2","key","value","update","setupEventListeners","socket","_this","on","monsterId","playerAttack","playerId","monster","exp","playerAttackValue","loseHealth","health","emit","deleteMonster","id","_this2","setInterval","keys","forEach","_movement","_this3","length","spawnMonster","pickRandomLocation","location","Math","floor","random","invalidLocation","some","obj","x","y","randomEnemy","enemies","console","log","MonsterModel","goldValue","concat","v4","healthValue","attackValue","expValue","addMonster","addLocation","push","getMonsterList","getMonster","getMonsterLocationList","move"],"sources":["../../../src/game_manager/controllers/MonsterController.js"],"sourcesContent":["import MonsterModel from \"../../models/MonsterModel\";\r\nimport * as enemyData from \"../../../public/assets/Enemies/enemies.json\";\r\nimport { v4 } from \"uuid\";\r\n\r\nexport default class MonsterController {\r\n  constructor(io) {\r\n    this.monsters = {};\r\n    this.monsterLocations = [];\r\n    this.io = io;\r\n\r\n    this.setupSpawn();\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    this.update();\r\n  }\r\n\r\n  setupEventListeners(socket) {\r\n    return socket.on(\"monsterHit\", (monsterId, playerAttack, playerId) => {\r\n      if (!this.monsters[monsterId]) return;\r\n      const monster = this.monsters[monsterId];\r\n      const { exp } = monster;\r\n      const playerAttackValue = playerAttack;\r\n      monster.loseHealth(playerAttackValue);\r\n\r\n      if (monster.health <= 0) {\r\n        socket.emit(\"playerUpdateXp\", playerId, exp);\r\n\r\n        this.deleteMonster(monster.id);\r\n      } else {\r\n        socket.emit(\"updateMonsterHealth\", monsterId, monster.health);\r\n      }\r\n    });\r\n  }\r\n\r\n  update() {\r\n    setInterval(() => {\r\n      Object.keys(this.monsters).forEach((id) => {\r\n        if (!this.monsters[id]) return;\r\n        this._movement(this.monsters[id]);\r\n      });\r\n    }, 1000);\r\n  }\r\n\r\n  setupSpawn() {\r\n    setInterval(() => {\r\n      if (Object.keys(this.monsters).length <= 8) {\r\n        this.spawnMonster();\r\n      }\r\n    }, 3000);\r\n  }\r\n\r\n  pickRandomLocation() {\r\n    const location =\r\n      this.monsterLocations[\r\n        Math.floor(Math.random() * this.monsterLocations.length)\r\n      ];\r\n\r\n    if (this.monsters.length > 0) {\r\n      const invalidLocation = this.monsters.some((obj) => {\r\n        if (obj.x === location[0] && obj.y === location[1]) {\r\n          return true;\r\n        }\r\n        return false;\r\n      });\r\n\r\n      if (invalidLocation) return this.pickRandomLocation();\r\n      return location || [200, 200];\r\n    }\r\n    return location || [200, 200];\r\n  }\r\n\r\n  spawnMonster() {\r\n    const randomEnemy =\r\n      enemyData.enemies[Math.floor(Math.random() * enemyData.enemies.length)];\r\n    console.log(\"spawnMonster\")\r\n    const location = this.pickRandomLocation();\r\n    const monster = new MonsterModel(\r\n      location[0],\r\n      location[1],\r\n      randomEnemy.goldValue, // gold value\r\n      `monster-${v4()}`,\r\n      randomEnemy.key, // key\r\n      randomEnemy.healthValue, // health value\r\n      randomEnemy.attackValue, // attack value\r\n      randomEnemy.expValue, // exp value\r\n      3000 //timer\r\n    );\r\n    this.addMonster(monster.id, monster);\r\n  }\r\n\r\n  addMonster(monsterId, monster) {\r\n    this.monsters[monsterId] = monster;\r\n    this.io.emit(\"monsterSpawned\", monster);\r\n  }\r\n\r\n  deleteMonster(monsterId) {\r\n    delete this.monsters[monsterId];\r\n    this.io.emit(\"monsterRemoved\", monsterId);\r\n  }\r\n\r\n  addLocation(x, y) {\r\n    this.monsterLocations.push([x, y]);\r\n  }\r\n\r\n  getMonsterList() {\r\n    return this.monsters;\r\n  }\r\n\r\n  getMonster(monsterId) {\r\n    return this.monsters[monsterId];\r\n  }\r\n  getMonsterLocationList() {\r\n    return this.monsterLocations;\r\n  }\r\n\r\n  _movement(monster) {\r\n    monster.move();\r\n    this.io.emit(\"monsterMovement\", monster);\r\n  }\r\n}\r\n"],"mappings":"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"}