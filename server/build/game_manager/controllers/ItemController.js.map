{"version":3,"sources":["../../../src/game_manager/controllers/ItemController.js"],"names":["ItemController","io","chests","items","itemDictionary","chest","createChest","bind","item","createItem","drop","socket","on","itemId","player","canPickupItem","addItem","emit","broadcast","id","deleteItems","chestId","gold","updateGold","deleteChest","x","y","ChestModel","addChest","randomItem","itemData","Math","floor","random","length","ItemModel","name","frame","WeaponTypes","MELEE","addItems"],"mappings":"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","sourcesContent":["import ChestModel from \"../../models/ChestModel\";\r\nimport ItemModel from \"../../models/ItemModel\";\r\nimport * as itemData from \"../../../public/assets/level/tools.json\";\r\nimport { v4 } from \"uuid\";\r\nimport { getRandonValues, randomNumber, WeaponTypes } from \"../utils\";\r\n\r\nexport default class ItemController {\r\n  constructor(io) {\r\n    this.chests = {};\r\n    this.items = {};\r\n    this.io = io;\r\n\r\n    this.itemDictionary = {\r\n      chest: this.createChest.bind(this),\r\n      item: this.createItem.bind(this),\r\n      \"\": this.drop.bind(this),\r\n    };\r\n  }\r\n\r\n  setupEventListeners(socket) {\r\n    socket.on(\"playerPickupItem\", (itemId, player) => {\r\n      if (this.items[itemId]) {\r\n        if (player.canPickupItem()) {\r\n          player.addItem(this.items[itemId]);\r\n          socket.emit(\"updateItems\", player);\r\n          socket.broadcast.emit(\r\n            \"updatePlayersItems\",\r\n            socket.id,\r\n            player\r\n          );\r\n          this.deleteItems(itemId);\r\n        }\r\n      }\r\n\r\n    });\r\n\r\n    socket.on(\"pickUpChest\", (chestId, player) => {\r\n      if (this.chests[chestId]) {\r\n        const { gold } = this.chests[chestId];\r\n        // updating the players gold\r\n        player.updateGold(gold);\r\n        socket.emit(\"updateScore\", player.gold);\r\n        socket.broadcast.emit(\r\n          \"updatePlayersScore\",\r\n          socket.id,\r\n          player.gold\r\n        );\r\n      this.deleteChest(chestId);\r\n      }\r\n    });\r\n\r\n    socket.on(\"dropItem\", (x, y, item) => {\r\n      this.itemDictionary[item](x, y);\r\n    });\r\n  }\r\n\r\n\r\n  addItems(itemId, item) {\r\n    this.items[itemId] = item;\r\n    this.io.emit(\"itemSpawned\", item);\r\n  }\r\n\r\n  deleteItems(itemId) {\r\n    delete this.items[itemId];\r\n    this.io.emit(\"itemRemoved\", itemId);\r\n  }\r\n\r\n  addChest(chestId, chest) {\r\n    this.chests[chestId] = chest;\r\n    this.io.emit(\"chestSpawned\", chest);\r\n  }\r\n\r\n  deleteChest(chestId) {\r\n    delete this.chests[chestId];\r\n    this.io.emit(\"chestRemoved\", chestId);\r\n  }\r\n\r\n  drop(x, y) {}\r\n\r\n  createChest(x, y) {\r\n    const chest = new ChestModel(x, y, randomNumber(10, 20), `chest-${v4()}`);\r\n    this.addChest(chest.id, chest);\r\n  }\r\n\r\n  createItem(x, y) {\r\n    const randomItem =\r\n      itemData.items[Math.floor(Math.random() * itemData.items.length)];\r\n\r\n    const item = new ItemModel(\r\n      x,\r\n      y,\r\n      `item-${v4()}`,\r\n      randomItem.name,\r\n      randomItem.frame,\r\n      getRandonValues(),\r\n      getRandonValues(),\r\n      getRandonValues(),\r\n      WeaponTypes.MELEE,\r\n      \"Description\"\r\n    );\r\n\r\n    this.addItems(item.id, item);\r\n  }\r\n}\r\n"],"file":"ItemController.js"}