{"version":3,"file":"index.js","names":["require","_path","_interopRequireDefault","_express","_bodyParser","_cors","_cookieParser","_passport","_mongoose","_main","_password","_secure","_GameManager","app","express","server","Server","io","cors","origin","process","env","CORS_ORIGIN","gameManager","GameManager","setup","port","PORT","uri","MONGO_CONNECTION_URL","mongoConfig","useNewUrlParser","authSource","MONGO_USER_NAME","MONGO_PASSWORD","auth","username","password","mongoose","connect","connection","on","error","console","log","exit","use","bodyParser","urlencoded","extended","json","cookieParser","credentials","get","passport","authenticate","session","request","response","status","user","path","join","__dirname","send","routes","passwordRoutes","secureRoutes","message","next","listen"],"sources":["../src/index.js"],"sourcesContent":["import \"dotenv/config\";\r\nimport path from \"path\";\r\nimport express from \"express\";\r\nimport bodyParser from \"body-parser\";\r\nimport cors from \"cors\";\r\nimport cookieParser from \"cookie-parser\";\r\nimport passport from \"passport\";\r\nimport mongoose from \"mongoose\";\r\n\r\nimport routes from \"./routes/main\";\r\nimport passwordRoutes from \"./routes/password\";\r\nimport secureRoutes from \"./routes/secure\";\r\nimport GameManager from \"./game_manager/GameManager\";\r\n\r\nconst app = express();\r\nconst server = require(\"http\").Server(app);\r\n//const io = require(\"socket.io\")(server);\r\nconst io = require(\"socket.io\")(server, {\r\n  cors: {\r\n    origin: process.env.CORS_ORIGIN,\r\n  },\r\n});\r\n\r\nconst gameManager = new GameManager(io);\r\ngameManager.setup();\r\nconst port = process.env.PORT || 3000;\r\n\r\nconst uri = process.env.MONGO_CONNECTION_URL;\r\nconst mongoConfig = {\r\n  useNewUrlParser: true,\r\n  authSource: \"admin\",\r\n};\r\n\r\nif (process.env.MONGO_USER_NAME && process.env.MONGO_PASSWORD) {\r\n  mongoConfig.auth = {};\r\n  mongoConfig.auth.username = process.env.MONGO_USER_NAME;\r\n  mongoConfig.auth.password = process.env.MONGO_PASSWORD;\r\n}\r\n\r\n//TODO\r\nmongoose.connect(uri, mongoConfig);\r\nmongoose.connection.on(\"error\", (error) => {\r\n  console.log(error);\r\n  process.exit(1);\r\n});\r\n\r\napp.use(bodyParser.urlencoded({ extended: false }));\r\napp.use(bodyParser.json());\r\napp.use(cookieParser());\r\napp.use(\r\n  cors({\r\n    credentials: true,\r\n    origin: process.env.CORS_ORIGIN,\r\n  })\r\n);\r\n\r\nrequire(\"./auth/auth\");\r\n\r\napp.get(\r\n  \"/game.html\",\r\n  passport.authenticate(\"jwt\", { session: false }),\r\n  (request, response) => {\r\n    response.status(200).json(request.user);\r\n  }\r\n);\r\n\r\napp.use(express.static(path.join(__dirname, \"/../public\")));\r\n\r\napp.get(\"/\", (request, response) => {\r\n  response.send(path.join(__dirname, \"/../index.html\"));\r\n});\r\n\r\napp.use(\"/\", routes);\r\napp.use(\"/\", passwordRoutes);\r\napp.use(\"/\", passport.authenticate(\"jwt\", { session: false }), secureRoutes);\r\n\r\napp.use((request, response) => {\r\n  response.status(404).json({ message: \"404 - Not Found\", status: 404 });\r\n});\r\n\r\napp.use((error, request, response, next) => {\r\n  console.log(error);\r\n  response\r\n    .status(error.status || 500)\r\n    .json({ error: error.message, status: 500 });\r\n});\r\n\r\nmongoose.connection.on(\"connected\", () => {\r\n  server.listen(port, () => {\r\n    console.log(\"Connected\");\r\n  });\r\n});\r\n"],"mappings":";;;AAAAA,OAAA;AACA,IAAAC,KAAA,GAAAC,sBAAA,CAAAF,OAAA;AACA,IAAAG,QAAA,GAAAD,sBAAA,CAAAF,OAAA;AACA,IAAAI,WAAA,GAAAF,sBAAA,CAAAF,OAAA;AACA,IAAAK,KAAA,GAAAH,sBAAA,CAAAF,OAAA;AACA,IAAAM,aAAA,GAAAJ,sBAAA,CAAAF,OAAA;AACA,IAAAO,SAAA,GAAAL,sBAAA,CAAAF,OAAA;AACA,IAAAQ,SAAA,GAAAN,sBAAA,CAAAF,OAAA;AAEA,IAAAS,KAAA,GAAAP,sBAAA,CAAAF,OAAA;AACA,IAAAU,SAAA,GAAAR,sBAAA,CAAAF,OAAA;AACA,IAAAW,OAAA,GAAAT,sBAAA,CAAAF,OAAA;AACA,IAAAY,YAAA,GAAAV,sBAAA,CAAAF,OAAA;AAEA,IAAMa,GAAG,GAAG,IAAAC,mBAAO,EAAC,CAAC;AACrB,IAAMC,MAAM,GAAGf,OAAO,CAAC,MAAM,CAAC,CAACgB,MAAM,CAACH,GAAG,CAAC;AAC1C;AACA,IAAMI,EAAE,GAAGjB,OAAO,CAAC,WAAW,CAAC,CAACe,MAAM,EAAE;EACtCG,IAAI,EAAE;IACJC,MAAM,EAAEC,OAAO,CAACC,GAAG,CAACC;EACtB;AACF,CAAC,CAAC;AAEF,IAAMC,WAAW,GAAG,IAAIC,uBAAW,CAACP,EAAE,CAAC;AACvCM,WAAW,CAACE,KAAK,CAAC,CAAC;AACnB,IAAMC,IAAI,GAAGN,OAAO,CAACC,GAAG,CAACM,IAAI,IAAI,IAAI;AAErC,IAAMC,GAAG,GAAGR,OAAO,CAACC,GAAG,CAACQ,oBAAoB;AAC5C,IAAMC,WAAW,GAAG;EAClBC,eAAe,EAAE,IAAI;EACrBC,UAAU,EAAE;AACd,CAAC;AAED,IAAIZ,OAAO,CAACC,GAAG,CAACY,eAAe,IAAIb,OAAO,CAACC,GAAG,CAACa,cAAc,EAAE;EAC7DJ,WAAW,CAACK,IAAI,GAAG,CAAC,CAAC;EACrBL,WAAW,CAACK,IAAI,CAACC,QAAQ,GAAGhB,OAAO,CAACC,GAAG,CAACY,eAAe;EACvDH,WAAW,CAACK,IAAI,CAACE,QAAQ,GAAGjB,OAAO,CAACC,GAAG,CAACa,cAAc;AACxD;;AAEA;AACAI,oBAAQ,CAACC,OAAO,CAACX,GAAG,EAAEE,WAAW,CAAC;AAClCQ,oBAAQ,CAACE,UAAU,CAACC,EAAE,CAAC,OAAO,EAAE,UAACC,KAAK,EAAK;EACzCC,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC;EAClBtB,OAAO,CAACyB,IAAI,CAAC,CAAC,CAAC;AACjB,CAAC,CAAC;AAEFhC,GAAG,CAACiC,GAAG,CAACC,sBAAU,CAACC,UAAU,CAAC;EAAEC,QAAQ,EAAE;AAAM,CAAC,CAAC,CAAC;AACnDpC,GAAG,CAACiC,GAAG,CAACC,sBAAU,CAACG,IAAI,CAAC,CAAC,CAAC;AAC1BrC,GAAG,CAACiC,GAAG,CAAC,IAAAK,wBAAY,EAAC,CAAC,CAAC;AACvBtC,GAAG,CAACiC,GAAG,CACL,IAAA5B,gBAAI,EAAC;EACHkC,WAAW,EAAE,IAAI;EACjBjC,MAAM,EAAEC,OAAO,CAACC,GAAG,CAACC;AACtB,CAAC,CACH,CAAC;AAEDtB,OAAO,CAAC,aAAa,CAAC;AAEtBa,GAAG,CAACwC,GAAG,CACL,YAAY,EACZC,oBAAQ,CAACC,YAAY,CAAC,KAAK,EAAE;EAAEC,OAAO,EAAE;AAAM,CAAC,CAAC,EAChD,UAACC,OAAO,EAAEC,QAAQ,EAAK;EACrBA,QAAQ,CAACC,MAAM,CAAC,GAAG,CAAC,CAACT,IAAI,CAACO,OAAO,CAACG,IAAI,CAAC;AACzC,CACF,CAAC;AAED/C,GAAG,CAACiC,GAAG,CAAChC,mBAAO,UAAO,CAAC+C,gBAAI,CAACC,IAAI,CAACC,SAAS,EAAE,YAAY,CAAC,CAAC,CAAC;AAE3DlD,GAAG,CAACwC,GAAG,CAAC,GAAG,EAAE,UAACI,OAAO,EAAEC,QAAQ,EAAK;EAClCA,QAAQ,CAACM,IAAI,CAACH,gBAAI,CAACC,IAAI,CAACC,SAAS,EAAE,gBAAgB,CAAC,CAAC;AACvD,CAAC,CAAC;AAEFlD,GAAG,CAACiC,GAAG,CAAC,GAAG,EAAEmB,gBAAM,CAAC;AACpBpD,GAAG,CAACiC,GAAG,CAAC,GAAG,EAAEoB,oBAAc,CAAC;AAC5BrD,GAAG,CAACiC,GAAG,CAAC,GAAG,EAAEQ,oBAAQ,CAACC,YAAY,CAAC,KAAK,EAAE;EAAEC,OAAO,EAAE;AAAM,CAAC,CAAC,EAAEW,kBAAY,CAAC;AAE5EtD,GAAG,CAACiC,GAAG,CAAC,UAACW,OAAO,EAAEC,QAAQ,EAAK;EAC7BA,QAAQ,CAACC,MAAM,CAAC,GAAG,CAAC,CAACT,IAAI,CAAC;IAAEkB,OAAO,EAAE,iBAAiB;IAAET,MAAM,EAAE;EAAI,CAAC,CAAC;AACxE,CAAC,CAAC;AAEF9C,GAAG,CAACiC,GAAG,CAAC,UAACJ,KAAK,EAAEe,OAAO,EAAEC,QAAQ,EAAEW,IAAI,EAAK;EAC1C1B,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC;EAClBgB,QAAQ,CACLC,MAAM,CAACjB,KAAK,CAACiB,MAAM,IAAI,GAAG,CAAC,CAC3BT,IAAI,CAAC;IAAER,KAAK,EAAEA,KAAK,CAAC0B,OAAO;IAAET,MAAM,EAAE;EAAI,CAAC,CAAC;AAChD,CAAC,CAAC;AAEFrB,oBAAQ,CAACE,UAAU,CAACC,EAAE,CAAC,WAAW,EAAE,YAAM;EACxC1B,MAAM,CAACuD,MAAM,CAAC5C,IAAI,EAAE,YAAM;IACxBiB,OAAO,CAACC,GAAG,CAAC,WAAW,CAAC;EAC1B,CAAC,CAAC;AACJ,CAAC,CAAC"}