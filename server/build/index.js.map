{"version":3,"sources":["../src/index.js"],"names":["app","server","require","Server","io","cors","origin","process","env","CORS_ORIGIN","gameManager","GameManager","setup","port","PORT","uri","MONGO_CONNECTION_URL","mongoConfig","useNewUrlParser","authSource","MONGO_USER_NAME","MONGO_PASSWORD","auth","username","password","mongoose","connect","connection","on","error","console","log","exit","use","bodyParser","urlencoded","extended","json","credentials","get","passport","authenticate","session","request","response","status","user","express","path","join","__dirname","send","routes","passwordRoutes","secureRoutes","message","next","listen"],"mappings":"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","sourcesContent":["import \"dotenv/config\";\r\nimport path from \"path\";\r\nimport express from \"express\";\r\nimport bodyParser from \"body-parser\";\r\nimport cors from \"cors\";\r\nimport cookieParser from \"cookie-parser\";\r\nimport passport from \"passport\";\r\nimport mongoose from \"mongoose\";\r\n\r\nimport routes from \"./routes/main\";\r\nimport passwordRoutes from \"./routes/password\";\r\nimport secureRoutes from \"./routes/secure\";\r\nimport GameManager from \"./game_manager/GameManager\";\r\n\r\nconst app = express();\r\nconst server = require(\"http\").Server(app);\r\n//const io = require(\"socket.io\")(server);\r\nconst io = require(\"socket.io\")(server, {\r\n  cors: {\r\n    origin: process.env.CORS_ORIGIN,\r\n  },\r\n});\r\n\r\nconst gameManager = new GameManager(io);\r\ngameManager.setup();\r\nconst port = process.env.PORT || 3000;\r\n\r\nconst uri = process.env.MONGO_CONNECTION_URL;\r\nconst mongoConfig = {\r\n  useNewUrlParser: true,\r\n  authSource: \"admin\",\r\n};\r\n\r\nif (process.env.MONGO_USER_NAME && process.env.MONGO_PASSWORD) {\r\n  mongoConfig.auth = {};\r\n  mongoConfig.auth.username = process.env.MONGO_USER_NAME;\r\n  mongoConfig.auth.password = process.env.MONGO_PASSWORD;\r\n}\r\n\r\n//TODO\r\nmongoose.connect(uri, mongoConfig);\r\nmongoose.connection.on(\"error\", (error) => {\r\n  console.log(error);\r\n  process.exit(1);\r\n});\r\n\r\napp.use(bodyParser.urlencoded({ extended: false }));\r\napp.use(bodyParser.json());\r\napp.use(cookieParser());\r\napp.use(\r\n  cors({\r\n    credentials: true,\r\n    origin: process.env.CORS_ORIGIN,\r\n  })\r\n);\r\n\r\nrequire(\"./auth/auth\");\r\n\r\napp.get(\r\n  \"/game.html\",\r\n  passport.authenticate(\"jwt\", { session: false }),\r\n  (request, response) => {\r\n    response.status(200).json(request.user);\r\n  }\r\n);\r\n\r\napp.use(express.static(path.join(__dirname, \"/../public\")));\r\n\r\napp.get(\"/\", (request, response) => {\r\n  response.send(path.join(__dirname, \"/../index.html\"));\r\n});\r\n\r\napp.use(\"/\", routes);\r\napp.use(\"/\", passwordRoutes);\r\napp.use(\"/\", passport.authenticate(\"jwt\", { session: false }), secureRoutes);\r\n\r\napp.use((request, response) => {\r\n  response.status(404).json({ message: \"404 - Not Found\", status: 404 });\r\n});\r\n\r\napp.use((error, request, response, next) => {\r\n  console.log(error);\r\n  response\r\n    .status(error.status || 500)\r\n    .json({ error: error.message, status: 500 });\r\n});\r\n\r\nmongoose.connection.on(\"connected\", () => {\r\n  server.listen(port, () => {\r\n    console.log(\"Connected\");\r\n  });\r\n});\r\n"],"file":"index.js"}