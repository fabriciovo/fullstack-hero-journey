{"version":3,"sources":["../../src/auth/auth.js"],"names":["passport","use","localStrategy","Strategy","usernameField","passwordField","passReqToCallback","request","email","password","done","username","body","UserModel","create","user","findOne","Error","isValidPassword","valid","jwtStrategy","secretOrKey","process","env","JWT_SECRET","jwtFromRequest","token","cookies","jwt"],"mappings":";;;;;;;;AACA;;AACA;;AACA;;AAEA;;AAEA;AACAA,qBAASC,GAAT,CAAa,QAAb,EAAuB,IAAIC,0BAAcC,QAAlB,CAA2B;AAChDC,EAAAA,aAAa,EAAE,OADiC;AAEhDC,EAAAA,aAAa,EAAE,UAFiC;AAGhDC,EAAAA,iBAAiB,EAAE;AAH6B,CAA3B;AAAA,2FAIpB,iBAAOC,OAAP,EAAgBC,KAAhB,EAAuBC,QAAvB,EAAiCC,IAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAESC,YAAAA,QAFT,GAEsBJ,OAAO,CAACK,IAF9B,CAESD,QAFT;AAAA;AAAA,mBAGoBE,sBAAUC,MAAV,CAAiB;AAAEN,cAAAA,KAAK,EAALA,KAAF;AAASC,cAAAA,QAAQ,EAARA,QAAT;AAAmBE,cAAAA,QAAQ,EAARA;AAAnB,aAAjB,CAHpB;;AAAA;AAGOI,YAAAA,IAHP;AAAA,6CAIQL,IAAI,CAAC,IAAD,EAAOK,IAAP,CAJZ;;AAAA;AAAA;AAAA;AAAA,6CAMQL,IAAI,aANZ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAJoB;;AAAA;AAAA;AAAA;AAAA,IAAvB,E,CAcA;;;AACAV,qBAASC,GAAT,CAAa,OAAb,EAAsB,IAAIC,0BAAcC,QAAlB,CAA2B;AAC/CC,EAAAA,aAAa,EAAE,OADgC;AAE/CC,EAAAA,aAAa,EAAE;AAFgC,CAA3B;AAAA,4FAGnB,kBAAOG,KAAP,EAAcC,QAAd,EAAwBC,IAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAEoBG,sBAAUG,OAAV,CAAkB;AAAER,cAAAA,KAAK,EAALA;AAAF,aAAlB,CAFpB;;AAAA;AAEOO,YAAAA,IAFP;;AAAA,gBAGMA,IAHN;AAAA;AAAA;AAAA;;AAAA,8CAIUL,IAAI,CAAC,IAAIO,KAAJ,CAAU,gBAAV,CAAD,EAA8B,KAA9B,CAJd;;AAAA;AAAA;AAAA,mBAMqBF,IAAI,CAACG,eAAL,CAAqBT,QAArB,CANrB;;AAAA;AAMOU,YAAAA,KANP;;AAAA,gBAOMA,KAPN;AAAA;AAAA;AAAA;;AAAA,8CAQUT,IAAI,CAAC,IAAIO,KAAJ,CAAU,kBAAV,CAAD,EAAgC,KAAhC,CARd;;AAAA;AAAA,8CAUQP,IAAI,CAAC,IAAD,EAAOK,IAAP,CAVZ;;AAAA;AAAA;AAAA;AAAA,8CAYQL,IAAI,cAZZ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAHmB;;AAAA;AAAA;AAAA;AAAA,IAAtB,E,CAmBA;;;AACAV,qBAASC,GAAT,CAAa,IAAImB,wBAAYjB,QAAhB,CAAyB;AACpCkB,EAAAA,WAAW,EAAEC,OAAO,CAACC,GAAR,CAAYC,UADW;AAEpCC,EAAAA,cAAc,EAAE,wBAAClB,OAAD,EAAa;AAC3B,QAAImB,KAAK,GAAG,IAAZ;AACA,QAAInB,OAAO,IAAIA,OAAO,CAACoB,OAAvB,EAAgCD,KAAK,GAAGnB,OAAO,CAACoB,OAAR,CAAgBC,GAAxB;AAChC,WAAOF,KAAP;AACD;AANmC,CAAzB;AAAA,4FAOV,kBAAOA,KAAP,EAAchB,IAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8CAEQA,IAAI,CAAC,IAAD,EAAOgB,KAAK,CAACX,IAAb,CAFZ;;AAAA;AAAA;AAAA;AAAA,8CAIQL,IAAI,cAJZ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAPU;;AAAA;AAAA;AAAA;AAAA,IAAb","sourcesContent":["\r\nimport passport from 'passport';\r\nimport localStrategy from 'passport-local';\r\nimport jwtStrategy from 'passport-jwt';\r\n\r\nimport UserModel from '../models/UserModel';\r\n\r\n// handle user registration\r\npassport.use('signup', new localStrategy.Strategy({\r\n  usernameField: 'email',\r\n  passwordField: 'password',\r\n  passReqToCallback: true,\r\n}, async (request, email, password, done) => {\r\n  try {\r\n    const { username } = request.body;\r\n    const user = await UserModel.create({ email, password, username });\r\n    return done(null, user);\r\n  } catch (error) {\r\n    return done(error);\r\n  }\r\n}));\r\n\r\n// handle user login\r\npassport.use('login', new localStrategy.Strategy({\r\n  usernameField: 'email',\r\n  passwordField: 'password',\r\n}, async (email, password, done) => {\r\n  try {\r\n    const user = await UserModel.findOne({ email });\r\n    if (!user) {\r\n      return done(new Error('user not found'), false);\r\n    }\r\n    const valid = await user.isValidPassword(password);\r\n    if (!valid) {\r\n      return done(new Error('invalid password'), false);\r\n    }\r\n    return done(null, user);\r\n  } catch (error) {\r\n    return done(error);\r\n  }\r\n}));\r\n\r\n// verify jwt token\r\npassport.use(new jwtStrategy.Strategy({\r\n  secretOrKey: process.env.JWT_SECRET,\r\n  jwtFromRequest: (request) => {\r\n    let token = null;\r\n    if (request && request.cookies) token = request.cookies.jwt;\r\n    return token;\r\n  },\r\n}, async (token, done) => {\r\n  try {\r\n    return done(null, token.user);\r\n  } catch (error) {\r\n    return done(error);\r\n  }\r\n}));\r\n"],"file":"auth.js"}