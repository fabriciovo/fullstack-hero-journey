{"version":3,"file":"auth.js","names":["_passport","_interopRequireDefault","require","_passportLocal","_passportJwt","_UserModel","passport","use","localStrategy","Strategy","usernameField","passwordField","passReqToCallback","_ref","_asyncToGenerator2","_regenerator","mark","_callee","request","email","password","done","username","player","user","wrap","_callee$","_context","prev","next","body","playerName","attack","defense","maxHealth","health","frame","key","gold","items","equipedItems","exp","maxExp","level","potions","UserModel","create","sent","abrupt","t0","stop","_x","_x2","_x3","_x4","apply","arguments","_ref2","_callee2","valid","_callee2$","_context2","findOne","Error","isValidPassword","_x5","_x6","_x7","jwtStrategy","secretOrKey","process","env","JWT_SECRET","jwtFromRequest","token","cookies","jwt","_ref3","_callee3","_callee3$","_context3","_x8","_x9"],"sources":["../../src/auth/auth.js"],"sourcesContent":["import passport from \"passport\";\nimport localStrategy from \"passport-local\";\nimport jwtStrategy from \"passport-jwt\";\n\nimport UserModel from \"../models/UserModel\";\n\n// handle user registration\npassport.use(\n  \"signup\",\n  new localStrategy.Strategy(\n    {\n      usernameField: \"email\",\n      passwordField: \"password\",\n      passReqToCallback: true,\n    },\n    async (request, email, password, done) => {\n      try {\n        const { username } = request.body;\n        const player = {\n          playerName: username,\n          attack: 25,\n          defense: 10,\n          maxHealth: 150,\n          health: 150,\n          frame: 0,\n          key: \"characters_1\",\n          gold: 20,\n          items: null,\n          equipedItems: null,\n          exp: 0,\n          maxExp: 100,\n          level: 1,\n          potions: 0,\n        };\n        const user = await UserModel.create({\n          email,\n          password,\n          username,\n          player,\n        });\n        return done(null, user);\n      } catch (error) {\n        return done(error);\n      }\n    }\n  )\n);\n\n// handle user login\npassport.use(\n  \"login\",\n  new localStrategy.Strategy(\n    {\n      usernameField: \"username\",\n      passwordField: \"password\",\n    },\n    async (username, password, done) => {\n      try {\n        const user = await UserModel.findOne({ username });\n        if (!user) {\n          return done(new Error(\"user not found\"), false);\n        }\n\n        if (!user.player) {\n          return done(new Error(\"user not found\"), false);\n        }\n        const valid = await user.isValidPassword(password);\n        if (!valid) {\n          return done(new Error(\"invalid password\"), false);\n        }\n        return done(null, user);\n      } catch (error) {\n        return done(error);\n      }\n    }\n  )\n);\n\n// verify jwt token\npassport.use(\n  new jwtStrategy.Strategy(\n    {\n      secretOrKey: process.env.JWT_SECRET,\n      jwtFromRequest: (request) => {\n        let token = null;\n        if (request && request.cookies) token = request.cookies.jwt;\n        return token;\n      },\n    },\n    async (token, done) => {\n      try {\n        return done(null, token.user);\n      } catch (error) {\n        return done(error);\n      }\n    }\n  )\n);\n"],"mappings":"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","ignoreList":[]}